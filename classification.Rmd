---
title: "classification"
author: "cshb26"
date: "3/19/2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
install.packages("naniar") #handle missing values 
```

```{r}
library("tidyverse")
library("ggplot2")
library("GGally")
```


## Problem Description

### Description of the data and the explanation of the objective of the analysis

```{r}
hotels0 = readr::read_csv("https://www.louisaslett.com/Courses/MISCADA/hotels.csv")
View(hotels0)
```

### Initial data summary

```{r}
skimr::skim(hotels0)
```


### （！！！）Simple visualisations of the data
```{r}
DataExplorer::plot_bar(hotels0, by = "is_canceled", ncol = 2)
```

```{r}
DataExplorer::plot_boxplot(hotels0, by = "is_canceled", ncol = 3)
```


## Model fitting

### 数据清洗
#### 删除冗余特征及非相关变量：
1. Drop `reservation_status` and `reservation_status_date`
2. 同时设置total_nights变量取代两个stays (Drop `stay`)
3. 同时设置kids变量取代children和babies (Drop `children` and `babies`)
4. reserved_room_type和assigned_room_type一致为1，不一致为0
5. create a new variable called parking which is either “parking” or “none” depending on the required_car_parking_spaces variable value
6. 将月份转换为factor
7. country、agent、company、日期和周数类别过多，不做考虑
```{r}
hotels1 <- hotels0 %>%
  mutate(total_nights = stays_in_weekend_nights+stays_in_week_nights) %>% 
  mutate(kids = case_when(children + babies > 0 ~ "kids", TRUE ~ "none")) %>%
  mutate(room_type = case_when(reserved_room_type == assigned_room_type ~ 1, TRUE ~ 0)) %>% 
  mutate(parking = case_when(required_car_parking_spaces > 0 ~ "parking", TRUE ~ "none")) %>% 
  mutate(arrival_date_month = as.integer(match(substr(arrival_date_month,1,3), month.abb)))

hotels2 <- hotels1 %>%
  select(-reservation_status, -reservation_status_date, -stays_in_weekend_nights, -stays_in_week_nights, -children, -babies, -reserved_room_type, -assigned_room_type, -required_car_parking_spaces, -country, -agent, -company, -arrival_date_day_of_month, -arrival_date_week_number)
```

```{r}
skimr::skim(hotels2)
```


#### 对剩余变量进行相关度分析
```{r}
ggpairs(hotels2 %>% select(hotel, meal, market_segment, distribution_channel, deposit_type, customer_type, kids, parking, adr, adults, is_canceled), aes(color = kids))
```


```{r}
ggpairs(hotels2 %>% select(kids, lead_time, is_repeated_guest, previous_cancellations, previous_bookings_not_canceled, previous_bookings_not_canceled, booking_changes, days_in_waiting_list, total_of_special_requests, total_nights, room_type, is_canceled), aes(color = kids))
```

根据图像(ggpairs或dataexplorer)删除几个特征
```{r}
hotels <- hotels2 %>% 
  select(-hotel, -meal, -market_segment, -distribution_channel, -kids, -parking, -adr, -total_nights)

skimr::skim(hotels)
```


### any train/test/validate, cross-validation, nested resampling or bootstrap strategies employed




### the approach taken to fitting, including any design, loss function, early stopping criteria, and algorithm choices




## Model improvements

### what model was finally selected and why


### summaries of different approaches tried before selecting the final model



### hyperparameter selection or tuning to improve model fits


### insights into improvements achieved through different architectures (deep learning), data augmentation approaches, regularisation methods, etc



## Performance report

### details on the performance of the model, including calibration



### reporting and justification of objective function choices



### would you be more worried about false negatives or false positives in this problem, and how could you address that concern

